# library - Utils
This package is used to call common utils in GogoJungle.
## Table of contents
- [How to add new util](#addnew)
- [Usage](#usage)
- [slack](#slack)
- [tracer](#tracer)

## <a name="addnew"></a>Create and add new util to library
Create new service at lib-utils/utils
```typescript
// lib-utils/utils/demo.ts
async function toUnix() {
 ...
}

export = {
  toUnix,
}
```

```shell script
$ yarn build
```

Update version of package.json

Public new common utils
````
$ npm publish -f --registry http://registry.gogojungle.net/
````

## <a name="usage"></a>Usage
Add lib to your `package.json`

```json
{
  "dependencies": {
    "@ggj/utils": "~<version>"
  }
}
```

## <a name="slack"></a>slack
Import slack util: [Usage](#usage)

Send the message with slack utils
- Function description:
````
slack.send(contentObject[, hookURL][, isBlockFlag = false])

contentObject: {[preContent:Object,] message: string | Object}
hookURL: string // slack webHook, default: process.env.DEFAULT_SLACK_WEBHOOK
isBlockFlag: boolean // Must be set equal true if message is slack block element
````
slack block: https://api.slack.com/reference/block-kit/blocks

Example:
```typescript
import { slack } from '@ggj/utils'
...

slack.send({
      message: err.stack,
      preContent: {
        request_url: req.originalUrl,
      }
    }, process.env.ERROR_SLACK_WEBHOOK)

...

slack.send({message: err.stack}) // precontent: Empty, webhook: process.env.DEFAULT_SLACK_WEBHOOK
```

## <a name="tracer"></a>tracer
### Node
Import tracer util where your service is initialized

Note that It must be initialized before any other module of your application, (like http or express) is loaded.
```typescript
// server.js
...
require('@ggj/utils/utils/tracer')
...
```
Add following config env to your service

```
TRACER_HOST_URL=HOST_OF_TRACER_COLLECTOR

Ex: TRACER_HOST_URL=http://127.0.0.1:8904

```

Disable tracing in individual service

```typescript
// Add the following Env variable to the service you want to disable tracing
// This Env will disable all tracing plugin

   OTEL_NO_PATCH_MODULES=*
```

Testing
 + Make a request to your service
 + Go to TRACER_HOST_URL at st.2 and filter service name with the name of your service
 + If your service displayed in collector GUI => successful
